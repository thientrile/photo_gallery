# Photo Gallery API

·ª®ng d·ª•ng Photo Gallery API ƒë∆∞·ª£c x√¢y d·ª±ng b·∫±ng Node.js, Express.js v√† MongoDB, t√≠ch h·ª£p v·ªõi Cloudinary ƒë·ªÉ l∆∞u tr·ªØ v√† qu·∫£n l√Ω h√¨nh ·∫£nh.

## üîó Links

- **GitHub Repository**: [https://github.com/thientrile/photo_gallery.git](https://github.com/thientrile/photo_gallery.git)
- **Postman Collection**: [Photo Gallery API Collection](https://www.postman.com/interstellar-resonance-246464/workspace/photo-gallery-api/request/25630734-c886feee-a61b-4a3b-b58f-2c2bd65d4bb6?action=share&source=copy-link&creator=25630734)

## üìã M·ª•c l·ª•c

- [Links](#-links)
- [T√≠nh nƒÉng](#-t√≠nh-nƒÉng)
- [C√¥ng ngh·ªá s·ª≠ d·ª•ng](#-c√¥ng-ngh·ªá-s·ª≠-d·ª•ng)
- [Y√™u c·∫ßu h·ªá th·ªëng](#-y√™u-c·∫ßu-h·ªá-th·ªëng)
- [C√†i ƒë·∫∑t](#-c√†i-ƒë·∫∑t)
- [C·∫•u h√¨nh](#-c·∫•u-h√¨nh)
- [Ch·∫°y ·ª©ng d·ª•ng](#-ch·∫°y-·ª©ng-d·ª•ng)
- [API Documentation](#-api-documentation)
- [Postman Collection](#-postman-collection)
- [C·∫•u tr√∫c project](#-c·∫•u-tr√∫c-project)
- [Database Schema](#-database-schema)
- [Validation Rules](#-validation-rules)

## üöÄ T√≠nh nƒÉng

- **Qu·∫£n l√Ω t√†i kho·∫£n**: ƒêƒÉng k√Ω, ƒëƒÉng nh·∫≠p, ƒëƒÉng xu·∫•t, refresh token
- **Qu·∫£n l√Ω h√¨nh ·∫£nh**: Upload, xem, x√≥a h√¨nh ·∫£nh v·ªõi Cloudinary
- **Qu·∫£n l√Ω album**: T·∫°o, ch·ªânh s·ª≠a, xem album h√¨nh ·∫£nh
- **Qu·∫£n l√Ω th·∫ª (tags)**: T·∫°o, x√≥a, xem c√°c th·∫ª g·∫Øn v·ªõi h√¨nh ·∫£nh
- **X√°c th·ª±c JWT**: B·∫£o m·∫≠t API v·ªõi JSON Web Token
- **Upload multiple files**: H·ªó tr·ª£ upload nhi·ªÅu file c√πng l√∫c
- **Responsive metadata**: L∆∞u tr·ªØ th√¥ng tin chi ti·∫øt v·ªÅ h√¨nh ·∫£nh (k√≠ch th∆∞·ªõc, ƒë·ªãnh d·∫°ng, dung l∆∞·ª£ng)

## üõ† C√¥ng ngh·ªá s·ª≠ d·ª•ng

- **Backend**: Node.js, Express.js
- **Database**: MongoDB v·ªõi Mongoose ODM
- **Cloud Storage**: Cloudinary
- **Authentication**: JSON Web Token (JWT)
- **File Upload**: Multer
- **Validation**: Joi
- **Security**: Helmet, CORS
- **Logging**: Morgan
- **Process Management**: Docker, Docker Compose

## üìã Y√™u c·∫ßu h·ªá th·ªëng

- Node.js >= 20.0.0
- MongoDB >= 4.4
- Docker & Docker Compose (t√πy ch·ªçn)
- T√†i kho·∫£n Cloudinary

## üîß C√†i ƒë·∫∑t

### 1. Clone repository

```bash
git clone https://github.com/thientrile/photo_gallery.git
cd photo_gallery
```

### 2. C√†i ƒë·∫∑t dependencies

```bash
npm install
```

### 3. C·∫•u h√¨nh m√¥i tr∆∞·ªùng

Sao ch√©p file `.env.example` th√†nh `.env`:

```bash
copy .env.example .env
```

## ‚öôÔ∏è C·∫•u h√¨nh

### C·∫•u h√¨nh file .env

```env
APPP_NAME=photo_gallery
VERSION=1.0.0
DESCRIPTION=Photo Gallery Application
PORT=3002
HOST=localhost

# Database Configuration
LOCAL_DB_CONNECTION=mongodb
LOCAL_DB_USER=root
LOCAL_DB_PASSWORD=123456
LOCAL_DB_HOST=localhost:27017

NODE_ENV=local

# Cloudinary Configuration
CLOUDINARY_NAME=your_cloudinary_name
CLOUDINARY_API_KEY=your_cloudinary_api_key
CLOUDINARY_API_SECRET=your_cloudinary_api_secret
```

### C·∫•u h√¨nh Cloudinary

1. ƒêƒÉng k√Ω t√†i kho·∫£n t·∫°i [Cloudinary](https://cloudinary.com/)
2. L·∫•y th√¥ng tin `Cloud Name`, `API Key`, `API Secret`
3. C·∫≠p nh·∫≠t v√†o file `.env`

## üöÄ Ch·∫°y ·ª©ng d·ª•ng

### Ch·∫°y v·ªõi Docker (Khuy·∫øn ngh·ªã)

```bash
# Kh·ªüi ƒë·ªông MongoDB
docker-compose up -d

# Ch·∫°y ·ª©ng d·ª•ng
npm run dev
```

### Ch·∫°y th·ªß c√¥ng

```bash
# Kh·ªüi ƒë·ªông MongoDB (c·∫ßn c√†i ƒë·∫∑t MongoDB local)
mongod

# Ch·∫°y ·ª©ng d·ª•ng ·ªü ch·∫ø ƒë·ªô development
npm run dev

# Ho·∫∑c ch·∫°y ·ªü ch·∫ø ƒë·ªô production
npm start
```

·ª®ng d·ª•ng s·∫Ω ch·∫°y t·∫°i: `http://localhost:3002`

## üìö API Documentation

### Base URL
```
http://localhost:3002/api
```

### Response Format
T·∫•t c·∫£ API responses ƒë·ªÅu c√≥ format th·ªëng nh·∫•t:

**Success Response:**
```json
{
  "status": "success",
  "message": "M√¥ t·∫£ th√†nh c√¥ng",
  "metadata": { /* d·ªØ li·ªáu tr·∫£ v·ªÅ */ }
}
```

**Error Response:**
```json
{
  "status": "Error",
  "code": 400,
  "message": "M√¥ t·∫£ l·ªói"
}
```

### HTTP Status Codes
- `200`: OK - Request th√†nh c√¥ng
- `201`: Created - T·∫°o m·ªõi th√†nh c√¥ng  
- `400`: Bad Request - D·ªØ li·ªáu ƒë·∫ßu v√†o kh√¥ng h·ª£p l·ªá
- `401`: Unauthorized - Ch∆∞a x√°c th·ª±c
- `403`: Forbidden - Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p
- `404`: Not Found - Kh√¥ng t√¨m th·∫•y resource
- `500`: Internal Server Error - L·ªói server

### Authentication
API s·ª≠ d·ª•ng 2 lo·∫°i token:
- **Access Token**: G·ª≠i qua header `Authorization: Bearer <access-token>`
- **Refresh Token**: G·ª≠i qua header `x-rtoken-id: <refresh-token>`

### Account Management

#### 1. ƒêƒÉng k√Ω t√†i kho·∫£n
```http
POST /api/account/register
Content-Type: application/json

{
  "name": "Nguyen Van A",
  "email": "user@example.com",
  "password": "password123"
}
```

**Response:**
```json
{
  "status": "success",
  "message": "Register Account",
  "metadata": {
    "user": {
      "id": "507f1f77bcf86cd799439011",
      "name": "Nguyen Van A",
      "email": "user@example.com",
      "slug": "uid123456"
    },
    "tokens": {
      "accessToken": "eyJhbGciOiJIUzI1NiIs...",
      "refreshToken": "eyJhbGciOiJIUzI1NiIs..."
    }
  }
}
```

#### 2. ƒêƒÉng nh·∫≠p
```http
POST /api/account/login
Content-Type: application/json

{
  "username": "user@example.com",
  "password": "password123"
}
```

**Response:**
```json
{
  "status": "success",
  "message": "Login Account",
  "metadata": {
    "user": {
      "id": "507f1f77bcf86cd799439011",
      "name": "Nguyen Van A",
      "email": "user@example.com",
      "slug": "uid123456"
    },
    "tokens": {
      "accessToken": "eyJhbGciOiJIUzI1NiIs...",
      "refreshToken": "eyJhbGciOiJIUzI1NiIs..."
    }
  }
}
```

#### 3. Refresh Token
```http
PATCH /api/account/refresh-token
x-rtoken-id: <your-refresh-token>
```

**Response:**
```json
{
  "status": "success",
  "message": "Refresh Token",
  "metadata": {
    "tokens": {
      "accessToken": "eyJhbGciOiJIUzI1NiIs...",
      "refreshToken": "eyJhbGciOiJIUzI1NiIs..."
    }
  }
}
```

#### 4. ƒêƒÉng xu·∫•t
```http
DELETE /api/account/logout
Authorization: Bearer <your-access-token>
```

**Response:**
```json
{
  "status": "success",
  "message": "Logout Account",
  "metadata": true
}
```

### Image Management

#### 1. Upload h√¨nh ·∫£nh
```http
POST /api/images/upload
Authorization: Bearer <your-access-token>
Content-Type: multipart/form-data

Form Data:
- files: [file1, file2, ...] (t·ªëi ƒëa 100 files)
- albumId: 123456 (t√πy ch·ªçn - ID s·ªë c·ªßa album)
- caption: "M√¥ t·∫£ h√¨nh ·∫£nh" (t√πy ch·ªçn)
- tags: ["tag1", "tag2"] (t√πy ch·ªçn)
```

**Response:**
```json
{
  "status": "success",
  "message": "Image uploaded successfully",
  "metadata": [
    {
      "id": 123456,
      "secureUrl": "https://res.cloudinary.com/...",
      "format": "jpg",
      "width": 1920,
      "height": 1080,
      "bytes": 245760,
      "tags": ["vacation", "beach"],
      "caption": "Beautiful sunset",
      "createdAt": "2025-08-03T10:30:00.000Z"
    }
  ]
}
```

#### 2. L·∫•y th√¥ng tin h√¨nh ·∫£nh
```http
GET /api/images/:imageId
Authorization: Bearer <your-access-token>
```

**Response:**
```json
{
  "status": "success",
  "message": "Image retrieved successfully",
  "metadata": {
    "id": 123456,
    "secureUrl": "https://res.cloudinary.com/...",
    "format": "jpg",
    "width": 1920,
    "height": 1080,
    "bytes": 245760,
    "tags": ["vacation", "beach"],
    "caption": "Beautiful sunset",
    "isPublic": false,
    "createdAt": "2025-08-03T10:30:00.000Z"
  }
}
```

#### 3. L·∫•y t·∫•t c·∫£ h√¨nh ·∫£nh c·ªßa user
```http
GET /api/images
Authorization: Bearer <your-access-token>
```

**Response:**
```json
{
  "status": "success",
  "message": "All images retrieved successfully",
  "metadata": [
    {
      "id": 123456,
      "secureUrl": "https://res.cloudinary.com/...",
      "format": "jpg",
      "width": 1920,
      "height": 1080,
      "caption": "Beautiful sunset",
      "createdAt": "2025-08-03T10:30:00.000Z"
    }
  ]
}
```

#### 4. L·∫•y h√¨nh ·∫£nh theo album
```http
GET /api/images/album/:albumId
Authorization: Bearer <your-access-token>
```

#### 5. X√≥a h√¨nh ·∫£nh
```http
DELETE /api/images/:imageId
Authorization: Bearer <your-access-token>
```

**Response:**
```json
{
  "status": "success",
  "message": "Image deleted successfully",
  "metadata": {
    "deleted": true,
    "imageId": "507f1f77bcf86cd799439011"
  }
}
```

### Album Management

#### 1. T·∫°o album m·ªõi
```http
POST /api/albums
Authorization: Bearer <your-access-token>
Content-Type: application/json

{
  "title": "K·ª≥ ngh·ªâ h√® 2025",
  "description": "Nh·ªØng k·ª∑ ni·ªám ƒë·∫πp t·ª´ k·ª≥ ngh·ªâ h√®",
  "cover_image": 123456
}
```

**Response:**
```json
{
  "status": "success",
  "message": "Album created successfully",
  "metadata": {
    "id": 789012,
    "title": "K·ª≥ ngh·ªâ h√® 2025",
    "description": "Nh·ªØng k·ª∑ ni·ªám ƒë·∫πp t·ª´ k·ª≥ ngh·ªâ h√®",
    "cover_image": "507f1f77bcf86cd799439011",
    "isPublic": false
  }
}
```

#### 2. L·∫•y t·∫•t c·∫£ album c·ªßa user
```http
GET /api/albums
Authorization: Bearer <your-access-token>
```

**Response:**
```json
{
  "status": "success",
  "message": "Albums retrieved successfully",
  "metadata": [
    {
      "id": 789012,
      "title": "K·ª≥ ngh·ªâ h√® 2025",
      "description": "Nh·ªØng k·ª∑ ni·ªám ƒë·∫πp t·ª´ k·ª≥ ngh·ªâ h√®",
      "cover_image": "507f1f77bcf86cd799439011",
      "isPublic": false
    }
  ]
}
```

#### 3. Ch·ªânh s·ª≠a album
```http
PATCH /api/albums/:albumId
Authorization: Bearer <your-access-token>
Content-Type: application/json

{
  "title": "K·ª≥ ngh·ªâ h√® 2025 - ƒê√£ c·∫≠p nh·∫≠t",
  "description": "M√¥ t·∫£ ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t",
  "cover_image": 654321
}
```

**Response:**
```json
{
  "status": "success",
  "message": "Album updated successfully",
  "metadata": {
    "id": 789012,
    "title": "K·ª≥ ngh·ªâ h√® 2025 - ƒê√£ c·∫≠p nh·∫≠t",
    "description": "M√¥ t·∫£ ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t",
    "cover_image": "507f1f77bcf86cd799439012",
    "isPublic": false
  }
}
```

### Tag Management

#### 1. T·∫°o tag m·ªõi
```http
POST /api/tags
Authorization: Bearer <your-access-token>
Content-Type: application/json

{
  "name": "vacation"
}
```

**Response:**
```json
{
  "status": "success",
  "message": "Tag created successfully",
  "metadata": {
    "id": 123456,
    "name": "vacation"
  }
}
```

#### 2. L·∫•y t·∫•t c·∫£ tags c·ªßa user
```http
GET /api/tags
Authorization: Bearer <your-access-token>
```

**Response:**
```json
{
  "status": "success",
  "message": "Tags retrieved successfully",
  "metadata": [
    {
      "id": 123456,
      "name": "vacation"
    },
    {
      "id": 123457,
      "name": "family"
    },
    {
      "id": 123458,
      "name": "nature"
    }
  ]
}
```

#### 3. X√≥a tag
```http
DELETE /api/tags/:tagId
Authorization: Bearer <your-access-token>
```

**Response:**
```json
{
  "status": "success",
  "message": "Tag deleted successfully",
  "metadata": true
}
```

## ÔøΩ Postman Collection

ƒê·ªÉ d·ªÖ d√†ng test v√† s·ª≠ d·ª•ng API, b·∫°n c√≥ th·ªÉ import Postman Collection:

**üîó Link Collection**: [Photo Gallery API Collection](https://www.postman.com/interstellar-resonance-246464/workspace/photo-gallery-api/request/25630734-c886feee-a61b-4a3b-b58f-2c2bd65d4bb6?action=share&source=copy-link&creator=25630734)

### C√°ch s·ª≠ d·ª•ng Postman Collection:

1. **Import Collection**:
   - M·ªü Postman
   - Click "Import" 
   - Paste link collection ·ªü tr√™n
   - Click "Continue" v√† "Import"

2. **Setup Environment**:
   - T·∫°o environment m·ªõi trong Postman
   - Th√™m c√°c variables:
     ```
     baseUrl: http://localhost:3002/api
     accessToken: (s·∫Ω ƒë∆∞·ª£c set t·ª± ƒë·ªông sau khi login)
     refreshToken: (s·∫Ω ƒë∆∞·ª£c set t·ª± ƒë·ªông sau khi login)
     ```

3. **Authentication Flow**:
   - Ch·∫°y **Register** ho·∫∑c **Login** request tr∆∞·ªõc
   - Tokens s·∫Ω ƒë∆∞·ª£c l∆∞u t·ª± ƒë·ªông v√†o environment variables
   - C√°c request kh√°c s·∫Ω t·ª± ƒë·ªông s·ª≠ d·ª•ng tokens n√†y

4. **Test Scenarios**:
   - **Account**: Register ‚Üí Login ‚Üí Refresh Token ‚Üí Logout
   - **Images**: Login ‚Üí Upload Images ‚Üí Get Images ‚Üí Delete Image
   - **Albums**: Login ‚Üí Create Album ‚Üí Get Albums ‚Üí Edit Album
   - **Tags**: Login ‚Üí Create Tag ‚Üí Get Tags ‚Üí Delete Tag

## ÔøΩüìÅ C·∫•u tr√∫c project

```
photo_gallery/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ controller/           # Controllers x·ª≠ l√Ω request/response
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Account/         # Account controller
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Gallery/         # Gallery controllers
‚îÇ   ‚îú‚îÄ‚îÄ model/               # MongoDB models
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.model.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ image.model.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ album.model.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tag.model.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ keytoken.model.js
‚îÇ   ‚îú‚îÄ‚îÄ service/             # Business logic
‚îÇ   ‚îú‚îÄ‚îÄ repository/          # Database operations
‚îÇ   ‚îú‚îÄ‚îÄ router/              # Route definitions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ account/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ gallery/
‚îÇ   ‚îú‚îÄ‚îÄ middleware/          # Custom middleware
‚îÇ   ‚îú‚îÄ‚îÄ dto/                 # Data Transfer Objects
‚îÇ   ‚îú‚îÄ‚îÄ utils/               # Utility functions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cloudinary/      # Cloudinary integration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mongo/           # MongoDB connection
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ multer/          # File upload handling
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validate/        # Input validation
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ handRespones/    # Response handling
‚îÇ   ‚îî‚îÄ‚îÄ app.js               # Express app configuration
‚îú‚îÄ‚îÄ config.js                # Application configuration
‚îú‚îÄ‚îÄ server.js                # Entry point
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ docker-compose.yaml      # Docker compose configuration
‚îú‚îÄ‚îÄ .env.example             # Environment variables template
‚îî‚îÄ‚îÄ README.md
```

## üíæ Database Schema

### User Schema
```javascript
{
  usr_id: Number,
  usr_slug: String,
  usr_email: String,
  usr_phone: String,
  usr_name: String,
  usr_salt: String,
  usr_sex: String,
  usr_avatar: String,
  usr_date_of_birth: Date,
  usr_status: String // 'pending', 'active', 'block'
}
```

### Image Schema
```javascript
{
  img_uploaderId: ObjectId, // ref: User
  img_albumId: ObjectId,    // ref: Album
  img_id: Number,
  img_url: String,
  img_secureUrl: String,
  img_publicId: String,     // Cloudinary public ID
  img_format: String,       // png, jpg, webp, etc.
  img_width: Number,
  img_height: Number,
  img_bytes: Number,
  img_tags: [String],
  img_caption: String,
  img_isPublic: Boolean
}
```

### Album Schema
```javascript
{
  alb_id: Number,
  alb_title: String,
  alb_description: String,
  alb_cover_image: ObjectId, // ref: Image
  alb_userId: ObjectId,      // ref: User
  alb_isPublic: Boolean
}
```

### Tag Schema
```javascript
{
  tag_id: Number,
  tag_name: String,
  tag_createdBy: ObjectId    // ref: User
}
```

## ÔøΩ Validation Rules

### Account Registration
- `name`: B·∫Øt bu·ªôc, t·ª´ 3-30 k√Ω t·ª±
- `email`: B·∫Øt bu·ªôc, format email h·ª£p l·ªá, unique
- `password`: B·∫Øt bu·ªôc, t·ªëi thi·ªÉu 6 k√Ω t·ª±

### Account Login  
- `username`: B·∫Øt bu·ªôc, format email h·ª£p l·ªá
- `password`: B·∫Øt bu·ªôc, t·ªëi thi·ªÉu 6 k√Ω t·ª±

### Album Creation
- `title`: B·∫Øt bu·ªôc, t·ª´ 2-100 k√Ω t·ª±
- `description`: T√πy ch·ªçn, t·ªëi ƒëa 500 k√Ω t·ª±
- `cover_image`: T√πy ch·ªçn, ID s·ªë c·ªßa h√¨nh ·∫£nh

### Image Upload
- `files`: B·∫Øt bu·ªôc, t·ªëi ƒëa 100 files
- `albumId`: T√πy ch·ªçn, ID s·ªë c·ªßa album
- `caption`: T√πy ch·ªçn, t·ªëi ƒëa 500 k√Ω t·ª±
- `tags`: T√πy ch·ªçn, m·∫£ng string

### Tag Creation
- `name`: B·∫Øt bu·ªôc, unique cho m·ªói user

## ÔøΩüõ°Ô∏è Security

- **JWT Authentication**: T·∫•t c·∫£ API ƒë·ªÅu ƒë∆∞·ª£c b·∫£o v·ªá b·∫±ng JWT
- **Input Validation**: S·ª≠ d·ª•ng Joi ƒë·ªÉ validate input
- **CORS**: C·∫•u h√¨nh CORS ƒë·ªÉ b·∫£o m·∫≠t cross-origin requests
- **Helmet**: B·∫£o m·∫≠t HTTP headers
- **Password Hashing**: M·∫≠t kh·∫©u ƒë∆∞·ª£c hash tr∆∞·ªõc khi l∆∞u

## üöÄ Deployment

### Production Environment Variables
```env
NODE_ENV=production
PORT=3000
HOST=0.0.0.0

# Production database
PRODUCTION_DB_CONNECTION=mongodb
PRODUCTION_DB_HOST=your-mongodb-uri
PRODUCTION_DB_USER=your-db-user
PRODUCTION_DB_PASSWORD=your-db-password

# JWT Secret (n√™n s·ª≠ d·ª•ng secret key m·∫°nh)
JWT_SECRET=your-strong-secret-key
JWT_EXPIRES_IN=7d

# Cloudinary production credentials
CLOUDINARY_NAME=your-production-cloudinary-name
CLOUDINARY_API_KEY=your-production-api-key
CLOUDINARY_API_SECRET=your-production-api-secret
```

## üìù Contributing

1. Fork repository
2. T·∫°o feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to branch (`git push origin feature/AmazingFeature`)
5. T·∫°o Pull Request

## üìû Support

N·∫øu c√≥ b·∫•t k·ª≥ v·∫•n ƒë·ªÅ g√¨, vui l√≤ng t·∫°o issue tr√™n GitHub repository.

## üìÑ License

This project is licensed under the ISC License.
